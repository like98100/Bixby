using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;



public class CookingGage : MonoBehaviour
{
    public Slider gageSlider; //게이지 슬라이더
    public Slider minSlider; //최소값 슬라이더
    public Slider maxSlider; //최대값 슬라이더


    public Text success_fail; //성공 실패 텍스트 나중에 변경
    public Text num; //현재 요리Text

    public int thisCook; //어떤 요리인지


    public bool cookingState; //요리가 가능한지 아닌지

    public bool start = false; //시작했는지 아닌지
    public float gageSpeed = 1.0f; //게이지 속도
    public float min_min = 0.4f; //최소값의 최소값
    public float min_max = 0.7f; //최소값의 최대값
    public float sliderInterval = 0.2f; //최소값 최대값 사이 길이

    

    private void Awake()
    {
        
    }


    // Start is called before the first frame update
    void Start()
    {
       
    }

    //아이템 데이터
    itemData cookData;

    // Update is called once per frame
    void Update()
    {


        if (start == true)
        {
            //게이지 슬라이더 증가
            gageSlider.value += gageSpeed * Time.deltaTime;
        }

        if (gageSlider.value == 1)
        {
            success_fail.text = "Fail";
            gageSlider.gameObject.SetActive(false);
            minSlider.gameObject.SetActive(false);
            maxSlider.gameObject.SetActive(false);
            gageSlider.value = 0;
            start = false;

            //아이템 지정 스크립트
            cookData.itemID = 2003; cookData.tag = new string[] { "food", "cooked" }; cookData.itemName = "실패한 요리";
            cookData.Left = -1; cookData.Up = -1; cookData.xSize = 3; cookData.ySize = 3;
            cookData.isEquip = false; cookData.isSell = false;
            cookData.price = 2; //나중에 가격 변경

            Vector2 tempPos;
            tempPos = inventoryObject.Inst.emptyCell(cookData.xSize, cookData.ySize);
            inventoryObject.Inst.itemGet(cookData.xSize, cookData.ySize, tempPos.x, tempPos.y, cookData);
        }

        //스페이스바 누르면 멈춤, 캐릭터 움직이는거 막아야함
        if (Input.GetKeyDown(KeyCode.Space))
        {
            if (gageSlider.value >= minSlider.value && gageSlider.value <= maxSlider.value)
            {
                success_fail.text = "Success";
                //성공한 요리 생성

                
                //아이템 지정 스크립트
                cookData.tag = new string[] { "food", "cooked" }; 
                cookData.Left = -1; cookData.Up = -1; 
                cookData.isEquip = false; cookData.isSell = false;
                cookData.price = 2; //나중에 가격 변경
            }
            else
            {
                success_fail.text = "Fail";
                //실패한 요리 생성

                //아이템 지정 스크립트
                cookData.itemID = 2003; cookData.tag = new string[] { "food", "cooked" }; cookData.itemName = "실패한 요리";
                cookData.Left = -1; cookData.Up = -1; cookData.xSize = 3; cookData.ySize = 3;
                cookData.isEquip = false; cookData.isSell = false;
                cookData.price = 2; //나중에 가격 변경
            }

            Vector2 tempPos;
            tempPos = inventoryObject.Inst.emptyCell(cookData.xSize, cookData.ySize);
            inventoryObject.Inst.itemGet(cookData.xSize, cookData.ySize, tempPos.x, tempPos.y, cookData);

            //대기시간 잠시 주고 슬라이더 삭제
            gageSlider.gameObject.SetActive(false);
            minSlider.gameObject.SetActive(false);
            maxSlider.gameObject.SetActive(false);
            gageSlider.value = 0;
            start = false;
        }
    }

    //요리하기 버튼 눌렀을 때 -> Cooking에 있는 변수를 받아와서 어던 요리를 하는지 판단해야함
    public void Cooking()
    {
        //초기화
        cookData = new itemData();
        //
        int FruitCount = 0;
        int GreenonionCount = 0;
        int RiceCount = 0;

        foreach (var item in inventoryObject.Inst.items.items)
        {
            if (item.tag.Length != 2)
            {
                continue;
            }
            if (item.tag[1] == "harvest")
            {
                switch (item.itemID)
                {
                    case 1000:
                        FruitCount++;
                        break;
                    case 1001:
                        GreenonionCount++;
                        break;
                    case 1002:
                        RiceCount++;
                        break;
                    default:
                        break;
                }
            }
        }
        

        cookData.itemName = num.text;

        if (num.text == "과일주스" && FruitCount >= 2)
        {
            cookData.itemID = 2001;
            cookData.xSize = 1; cookData.ySize = 2;
            //요리 재료 제거
            //길이는 소모하는 재료 수
            for (int i = 0; i < 2; i++)
            {
                foreach (var item in inventoryObject.Inst.itemObjects)
                {
                    if (item.tag.Length != 2)
                    {
                        continue;
                    }

                    if (item.GetComponent<itemObject>().ItemData.tag[1] == "harvest" && item.GetComponent<itemObject>().ItemData.itemID == 1000)
                    {
                        FruitCount--;
                        inventoryObject.Inst.throwItem(item, false);
                        break;
                    }
                }
            }
        }
        else if (num.text == "한식" && GreenonionCount >= 1 && RiceCount >= 1)
        {
            cookData.itemID = 2002;
            cookData.xSize = 2; cookData.ySize = 1;
            //요리 재료 제거
            foreach (var item in inventoryObject.Inst.itemObjects)
            {
                if (item.tag.Length != 2)
                {
                    continue;
                }

                if (item.GetComponent<itemObject>().ItemData.tag[1] == "harvest" && item.GetComponent<itemObject>().ItemData.itemID == 1001)
                {
                    GreenonionCount--;
                    inventoryObject.Inst.throwItem(item, false);
                    break;
                }
            }
            foreach (var item in inventoryObject.Inst.itemObjects)
            {
                if (item.tag.Length != 2)
                {
                    continue;
                }

                if (item.GetComponent<itemObject>().ItemData.tag[1] == "harvest" && item.GetComponent<itemObject>().ItemData.itemID == 1002)
                {
                    RiceCount--;
                    inventoryObject.Inst.throwItem(item, false);
                    break;
                }
            }
        }
        else
        {
            success_fail.text = "-";
            return;
        }


        success_fail.text = "-";
        //요리시작할때 setActive키기
        if (gageSlider.gameObject.activeSelf == false)
        {
            gageSlider.gameObject.SetActive(true);
        }
        if (minSlider.gameObject.activeSelf == false)
        {
            minSlider.gameObject.SetActive(true);

            //랜덤으로 값 주기
            minSlider.value = Random.Range(min_min, min_max);
            maxSlider.value = minSlider.value + sliderInterval;
        }
        if (maxSlider.gameObject.activeSelf == false)
        {
            maxSlider.gameObject.SetActive(true);
        }
        //요리시작
        start = true;
    }
}
